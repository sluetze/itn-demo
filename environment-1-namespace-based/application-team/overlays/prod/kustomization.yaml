apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: sluetzen-frontend-team-prod
  labels:
    environment: prod

resources:
- ../../

namespace: sluetzen-frontend-team-prod

commonLabels:
  environment: prod

# Override environment-specific configuration
configMapGenerator:
- name: environment-config
  behavior: replace
  literals:
  - NAMESPACE_NAME=sluetzen-frontend-team-prod
  - ENVIRONMENT=prod
  - CPU_LIMIT=8
  - MEMORY_LIMIT=16Gi
  - STORAGE_LIMIT=50Gi
  - TEAM_NAME=frontend-team
  - CLUSTER_DOMAIN=apps.cluster.local

patchesStrategicMerge:
- namespace-patch.yaml
- resourcequota-patch.yaml

# Environment-specific replacements
replacements:
- source:
    kind: ConfigMap
    name: environment-config
    fieldPath: data.ENVIRONMENT
  targets:
  - select:
      kind: Namespace
    fieldPaths:
    - metadata.labels.environment
    - metadata.annotations.environment
  - select:
      kind: ResourceQuota
    fieldPaths:
    - metadata.labels.environment
  - select:
      kind: Role
    fieldPaths:
    - metadata.labels.environment
  - select:
      kind: RoleBinding
    fieldPaths:
    - metadata.labels.environment
  - select:
      kind: LimitRange
    fieldPaths:
    - metadata.labels.environment